# SPDX-FileCopyrightText: 2023 Colin-Tel
# SPDX-FileCopyrightText: 2023 Fluffiest Floofers
# SPDX-FileCopyrightText: 2023 PHCodes
# SPDX-FileCopyrightText: 2024 DEATHB4DEFEAT
# SPDX-FileCopyrightText: 2024 Danger Revolution!
# SPDX-FileCopyrightText: 2024 Mnemotechnican
# SPDX-FileCopyrightText: 2024 VMSolidus
# SPDX-FileCopyrightText: 2025 Jakumba
# SPDX-FileCopyrightText: 2025 Rosycup
# SPDX-FileCopyrightText: 2025 sleepyyapril
#
# SPDX-License-Identifier: MIT AND AGPL-3.0-or-later
- type: entityTable
  id: BasicCalmEventsTableDeltaV
  table: !type:AllSelector # we need to pass a list of rules, since rules have further restrictions to consider via StationEventComp
    children:
    - id: MothroachSpawn
    - id: XenoVents
    - id: MalignRiftSpawn

- type: entityTable
  id: BasicAntagEventsTableDeltaV
  table: !type:AllSelector # we need to pass a list of rules, since rules have further restrictions to consider via StationEventComp
    children:
#    - id: Fugitive
#    - id: ListeningPost
#    - id: RoboNeuroticist
#    - id: MenaceSkeleton
    - id: SkiaSpawn

# Replaces upstream meteor events until they're good
- type: entity
  parent: BaseStationEventLongDelay
  id: MeteorSwarm
  components:
  - type: StationEvent
    earliestStart: 30
    weight: 7.5
    minimumPlayers: 10 #Enough to hopefully have at least one engineering guy
    startAnnouncement: station-event-meteor-swarm-start-announcement
    endAnnouncement: station-event-meteor-swarm-end-announcement
    startAudio:
      path: /Audio/Announcements/meteors.ogg
      params:
        volume: -4
    duration: null #ending is handled by MeteorSwarmRule
#  - type: PrecognitionResult
#    message: psionic-power-precognition-meteor-swarm-result-message
  - type: MeteorSwarmRule

- type: entity
  id: XenoVents
  parent: BaseVentCritterSpawn
  categories: [ HideSpawnMenu ]
  components:
  - type: StationEvent
    startAnnouncement: true
    earliestStart: 15
    reoccurrenceDelay: 12
    minimumPlayers: 10
    weight: 8 # Really weak compared to other critters
    duration: 30
  - type: VentCrittersRule
    sound: /Audio/_DEN/VentCritters/vent_xeno.ogg #Den
    specialEntries:
      - id: MobXenoPraetorian
    table: !type:GroupSelector # DeltaV: EntityTable instead of spawn entries
      children:
      - id: MobXeno
        weight: 0.55
      - id: MobXenoRouny
        weight: 0.01
      - id: MobXenoDrone
        weight: 0.25
      - id: MobXenoSpitter
        weight: 0.05
      - id: MobXenoRunner
        weight: 0.08
      - id: MobXenoPraetorian
        weight: 0.03
      - id: MobXenoRavager
        weight: 0.02
      - id: MobXenoQueen
        weight: 0.01

# Weaker version of xenos, meant to provide some dangers in low pop.
- type: entity
  id: XenoVentsWeak
  parent: XenoVents
  categories: [ HideSpawnMenu ]
  components:
  - type: StationEvent
    startAnnouncement: true
    reoccurrenceDelay: 12
    minimumPlayers: 1
    duration: 30
  - type: VentCrittersRule
    specialEntries:
      - id: MobXenoDrone
    table: !type:GroupSelector # DeltaV: EntityTable instead of spawn entries
      children:
      - id: MobXeno
        weight: 0.55
      - id: MobXenoRouny
        weight: 0.01
      - id: MobXenoDrone
        weight: 0.25
      - id: MobXenoSpitter
        weight: 0.05
      - id: MobXenoRunner
        weight: 0.08
      - id: MobXenoRavager
        weight: 0.02

- type: entity
  id: PirateRadioSpawn
  parent: BaseGameRule
  categories: [ HideSpawnMenu ]
  components:
  - type: StationEvent
    weight: 7.5
    minimumPlayers: 10
    maxOccurrences: 1
    duration: 1
    minimumPlayers: 30
#  - type: PrecognitionResult
#    message: psionic-power-precognition-closet-skeleton-result-message
  - type: AntagSpawner
    prototype: MobMenaceSkeleton
  - type: AntagRandomObjectives
    sets:
    - groups: SkeletonObjectiveGroup
      maxPicks: 2 # only pick 2 of 4
    maxDifficulty: 100 # ignore difficulty, use maxPicks instead
  - type: AntagSelection
    agentName: menace-skeleton-round-end-name
    definitions:
    - spawnerPrototype: SpawnPointMenaceSkeleton
      min: 1
      max: 1
      pickPlayer: false
      components:
      - type: RandomMetadata
        nameSegments:
        - NamesFakeHumanFirst
        - NamesFakeHumanLast
        nameFormat: name-format-standard
      - type: RandomHumanoidAppearance
        randomizeName: false
      - type: EmitSoundOnSpawn # fell out of the ceiling
        sound: /Audio/Effects/clang.ogg
      mindRoles:
      - MindRoleMenaceSkeleton
