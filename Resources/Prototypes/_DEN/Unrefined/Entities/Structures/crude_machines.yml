# Abstract Parents so we don't have to include unnecessary components
# Should find a way to do these without messing with powered components

- type: entity
  parent: BaseStructure
  id: BaseHandPoweredDevice
  abstract: true
  components:
  - type: InteractionOutline
  #- type: Anchorable
  #  delay: 2
  - type: Physics
    bodyType: Static
  - type: Transform
    noRot: true
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.45,-0.45,0.45,0.45"
        density: 190
        mask:
        - MachineMask
        layer:
        - MachineLayer
  - type: Damageable
    damageContainer: Inorganic
    damageModifierSet: Metallic
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
        - !type:DoActsBehavior
          acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 100
      behaviors:
      - !type:DoActsBehavior
        acts: ["Destruction"]
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
  - type: InteractionVerbs
    allowedVerbs:
    - KnockOn
  - type: ApcPowerReceiver
    needsPower: false
  #- type: ExtensionCableReceiver
  #- type: LightningTarget
  #  priority: 1

  
- type: entity
  parent: BaseHandPoweredDevice #[BaseLathe, BaseMaterialSiloUtilizer]
  id: BaseHandPoweredLathe
  abstract: true
  components:
  - type: Appearance
  #- type: WiresVisuals
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.4,-0.4,0.4,0.4"
        density: 190
        mask:
        - MachineMask
        layer:
          - MachineLayer
  - type: Lathe
  - type: MaterialStorage
  #- type: Destructible
  #  thresholds:
  #  - trigger:
  #      !type:DamageTrigger
  #      damage: 100
  #    behaviors:
  #    - !type:PlaySoundBehavior
  #      sound:
  #        collection: MetalBreak
  #    - !type:ChangeConstructionNodeBehavior
  #      node: machineFrame
  #    - !type:DoActsBehavior
  #      acts: ["Destruction"]
  #- type: WiresPanel
  - type: ActivatableUI
    key: enum.LatheUiKey.Key
  - type: ActivatableUIRequiresPower
  - type: UserInterface
    interfaces:
      enum.LatheUiKey.Key:
        type: LatheBoundUserInterface
      enum.ResearchClientUiKey.Key:
        type: ResearchClientBoundUserInterface
  - type: Transform
    anchored: true
  #- type: Pullable
  - type: StaticPrice
    price: 800
  #- type: ResearchClient
  #- type: TechnologyDatabase
  #- type: Speech # Goobstation - Lathe message on recipes update
  #  speechSounds: Lathe
  - type: AutomationSlots # Goobstation
    slots:
    - !type:AutomatedMaterialStorage
      input: AutomationSlotMaterials
      output: null

# Now the structures themselves

- type: entity
  parent: BaseHandPoweredLathe # [BaseLathe, BaseMaterialSiloUtilizer]
  id: CraftingTable
  name: crafting table
  description: It's easier to put things together if you can hold them against a surface.
  components:
  - type: Anchorable
    delay: 2
  - type: Pullable
  - type: Sprite
    sprite: _DEN\Unrefined\Structures\Machines\crafting_table.rsi
    state: crafting_table
  - type: MaterialStorage
    ignoreColor: true
    whitelist:
      tags:
      - Ore
      - Wooden
      - RawMaterial
      - ClothMade
      - Gauze
      - Sheet
      - RawMaterial
      - Ingot
      - Metal
  - type: Lathe
    producingSound: /Audio/Effects/metal_scrape3.ogg
    idleState: crafting_table
    runningState: crafting_table
    defaultProductionAmount: 1
    staticPacks:
    - CraftingTableStatic
  - type: Construction
    graph: CraftingTable
    node: table

- type: entity
  parent: BaseHandPoweredLathe # [BaseLathe, BaseMaterialSiloUtilizer]
  id: StoneFurnace
  name: stone furnace
  description: It produces sheets and ingots using ores.
  components:
  - type: Sprite
    sprite: _DEN\Unrefined\Structures\Machines\stone_furnace.rsi
    state: stone_furnace_glow
  - type: PointLight
    radius: 1.5
    energy: 2.5
    enabled: true
    color: "#FFDDAA"
  - type: MaterialStorage
    ignoreColor: true
    whitelist:
      tags:
      - Ore
      - Wooden
  - type: Lathe
    producingSound: /Audio/Effects/burning.ogg
    idleState: stone_furnace_glow
    runningState: stone_furnace_glow
    defaultProductionAmount: 1
    staticPacks:
    - StoneFurnaceStatic
  - type: Construction
    graph: StoneFurnace
    node: furnace

- type: entity
  parent: BaseHandPoweredLathe # [BaseLathe, BaseMaterialSiloUtilizer]
  id: CastAnvil
  name: cast anvil
  description: It turns metal into bonked metal.
  components:
  - type: Anchorable
    delay: 2
  - type: Pullable
  - type: ApcPowerReceiver
    needsPower: false
  - type: Sprite
    sprite: _DEN\Unrefined\Structures\Machines\cast_anvil.rsi
    state: cast_anvil
  - type: MaterialStorage
    ignoreColor: true
    whitelist:
      tags:
      - Sheet
      - RawMaterial
      - Ingot
      - Wooden
      - ClothMade
      - Gauze
      - Metal
  - type: Lathe
    producingSound: /Audio/Effects/clang.ogg
    idleState: cast_anvil
    runningState: cast_anvil
    defaultProductionAmount: 1
    staticPacks:
    - CastAnvilStatic
  - type: Construction
    graph: CastAnvil
    node: anvil
      
- type: entity
  id: ClayOven
  suffix: Survival
  parent: BaseHandPoweredDevice # [ BaseMachinePowered, SmallConstructibleMachine ]
  name: clay oven
  description: Turns inedible mush into delectible food.
  components:
  - type: ApcPowerReceiver
    needsPower: false
  - type: Microwave
    capacity: 10
  - type: ActivatableUI
    key: enum.MicrowaveUiKey.Key
  - type: UserInterface
    interfaces:
      enum.MicrowaveUiKey.Key:
        type: MicrowaveBoundUserInterface
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.3,-0.5,0.3,0.5"
        density: 500
        mask:
        - TabletopMachineMask
        layer:
        - TabletopMachineLayer
  - type: Sprite
    sprite: _DEN/Unrefined/Structures/Machines/clay_oven.rsi
    #drawdepth: SmallObjects
    snapCardinals: true
    layers:
    - state: mw0
      map: ["enum.MicrowaveVisualizerLayers.Base"]
    #- state: mw_unlit
    #  shader: unshaded
    #  map: ["enum.MicrowaveVisualizerLayers.BaseUnlit"]
    #- state: mwbloody0
    #  map: ["bloody"]
    #  visible: false
    #- state: mwbloody1
    #  shader: unshaded
    #  map: ["bloodyunshaded"]
    #  visible: false
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 100
      behaviors:
      - !type:DoActsBehavior
        acts: ["Breakage"]
  - type: ContainerContainer
    containers:
      microwave_entity_container: !type:Container
  - type: AutomationSlots # Goobstation
    slots:
    - !type:AutomatedContainer
      input: AutomationSlotInput
      output: AutomationSlotInput
      containerId: microwave_entity_container
      maxItems: 10 # have to manually keep it in sync with capacity on Microwave at the top
  - type: EmptyOnMachineDeconstruct
    containers:
    - microwave_entity_container
  - type: GuideHelp
    guides:
    - Chef
  - type: Construction
    graph: ClayOven
    node: oven
    
- type: entity
  id: GrindingMortar
  parent: BaseHandPoweredDevice # [ BaseMachinePowered, SmallConstructibleMachine ]
  name: grinding mortar
  description: Gotta put in some serious armwork to get even a crumb.
  suffix: grinder/juicer
  components:
  - type: Anchorable
    delay: 2
  - type: Pullable
  - type: Transform
    anchored: true
  - type: ReagentGrinder
  - type: ActivatableUI
    key: enum.ReagentGrinderUiKey.Key
  - type: UserInterface
    interfaces:
      enum.ReagentGrinderUiKey.Key:
        type: ReagentGrinderBoundUserInterface
  - type: Appearance
  - type: GenericVisualizer
    visuals:
      enum.ReagentGrinderVisualState.BeakerAttached:
        grinder:
          True: {state: "mortar1"}
          False: {state: "mortar0"}
  - type: Physics
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.3,-0.3,0.3,0.3"
        density: 160
        mask:
        - TabletopMachineMask
        layer:
        - TabletopMachineLayer
  - type: Sprite
    sprite: _DEN/Unrefined/Structures/Machines/grinding_mortar.rsi
    drawdepth: SmallObjects
    snapCardinals: true
    offset: "0.0,0.0"
    layers:
    - map: [ "grinder" ]
      state: "mortar0"
  - type: ApcPowerReceiver
    needsPower: false
  - type: ItemSlots
    slots:
      beakerSlot:
        whitelist:
          components:
          - FitsInDispenser
  - type: AutomationSlots # Goobstation
    slots:
    - !type:AutomatedItemSlot
      input: AutomationSlotBeaker
      output: AutomationSlotBeaker
      slotId: beakerSlot
    - !type:AutomatedContainer
      input: AutomationSlotInput
      output: AutomationSlotInput
      whitelist:
        components:
        - Extractable # shitcode doesnt require this with container attempt events just in interaction
      containerId: inputContainer
      maxItems: 6 # manually have to sync it with ReagentGrinderComponent :)
  - type: Machine
    board: ReagentGrinderMachineCircuitboard
  - type: ContainerContainer
    containers:
      beakerSlot: !type:ContainerSlot
      inputContainer: !type:Container
      machine_board: !type:Container
      machine_parts: !type:Container
  - type: Construction
    graph: GrindingMortar
    node: mortar      
      
      
- type: entity
  parent: BaseHandPoweredDevice # BaseHeaterMachine
  id: CookingFire
  name: cooking fire
  description: The dawn of the culinary arts.
  components:
  - type: Transform
    anchored: true
  - type: Appearance
  - type: Sprite
    sprite: _DEN/Unrefined/Structures/Machines/cooking_fire.rsi
    drawdepth: SmallObjects
    snapCardinals: true
    layers:
    - state: icon
    - map: ["enum.EntityHeaterVisuals.Setting"]
      shader: unshaded
      visible: false
  - type: ApcPowerReceiver
    needsPower: false
    powerLoad: 0 # off by default
  - type: EntityHeater
    power: 1600
  - type: ItemPlacer
    maxEntities: 6
    whitelist:
      components:
      - Temperature
  - type: Fixtures # DEN - Allow anchoring on tables
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.5,-0.5,0.5,0.5"
        mask:
        - TabletopMachineMask
        layer:
        - TabletopMachineLayer
        hard: false
  - type: PlaceableSurface
  - type: GenericVisualizer
    visuals:
      enum.EntityHeaterVisuals.Setting:
        enum.EntityHeaterVisuals.Setting:
          Off: { visible: false }
          Low: { visible: true, state: low }
          Medium: { visible: true, state: medium }
          High: { visible: true, state: high }
  #- type: SolutionHeater
  #  baseHeatPerSecond: 100
  #  heatPerSecond: 100
  #- type: ItemPlacer
  #  whitelist:
  #    components:
  #    - FitsInDispenser
  #- type: PlaceableSurface
  #  placeCentered: true
  #  positionOffset: 0, 0.25
  - type: PointLight
    radius: 5
    energy: 3
    enabled: true
    color: "#FFC90C"
  - type: Construction
    graph: CookingFire
    node: fire
    
- type: entity
  parent: FloorDrain
  id: FloorDrainSump
  name: drainage sump
  description: A covered hole in the floor that slowly drains puddles around it into the ground.
  components:
  - type: Construction
    graph: DrainageSump
    node: sump
  - type: Sprite
    drawdepth: FloorObjects
    sprite: _DEN/Unrefined/Structures/Misc/sump.rsi
    layers:
    - state: icon
    - map: [ "enum.SolutionContainerLayers.Fill" ]
      state: fill-1
      visible: false
  - type: SolutionContainerManager
    solutions:
      drainBuffer:
        maxVol: 1000
