# Magic Runes

- type: entity
  parent: BaseItem
  id: StoneRune
  name: stone rune
  description:  A rock inscribed with lines drawn from dreams.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Materials/stone_rune.rsi
    layers:
    - state: stone
  - type: Damageable
    damageContainer: Inorganic
    damageModifierSet: Glass
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 100
      behaviors:
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: StaticPrice
    price: 5
  - type: Construction
    graph: MagicRune
    node: stone
    
- type: entity
  parent: StoneRune
  id: MagicRune
  name: magic rune
  description:  A rock inlayed with fundamental cosmic forces.
  components:
  - type: Sprite
    layers:
    - state: stone
    - state: pastel
      shader: unshaded
  - type: Tag
    tags:
    - MagicRune
  - type: Construction
    graph: MagicRune
    node: magic

- type: Tag
  id: MagicRune
  
- type: entity
  parent: MagicRune
  id: MagicRuneColor
  name: colorful magic rune
  description:  You've never seen such a magical rock.
  components:
  - type: Sprite
    layers:
    - state: stone
    - state: magic
      shader: unshaded
  - type: Tag
    tags:
    - MagicRune
    - MagicRuneColor
  - type: Construction
    graph: MagicRune
    node: colorful

- type: Tag
  id: MagicRuneColor


# Magic Wands

- type: entity
  id: BaseMagicItem
  parent: BaseItem
  abstract: true
  components:
  - type: Sprite
  - type: Item
    size: Small
  - type: Appearance
  - type: StaticPrice
    price: 500
  - type: InteractionVerbs
    allowedVerbs:
    - HugObject
    - KissObject
    - LickObject

- type: entity
  id: BaseWeaponWand
  parent: BaseMagicItem
  abstract: true
  components:
  - type: AmmoCounter
  - type: Gun
    fireRate: 2
    selectedMode: SemiAuto
    availableModes:
    - SemiAuto
    fireOnDropChance: 0
    soundGunshot:
      path: /Audio/Weapons/Guns/Gunshots/laser.ogg
  - type: MagazineVisuals
    magState: mag
    steps: 5
    zeroVisible: false
    
- type: entity
  name: test wand
  parent: BaseWeaponWand
  id: WandTest
  description: If you see this, please pay no attention.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: wand
  - type: BallisticAmmoProvider
    capacity: 5
    proto: VirtualAmmo
    
- type: entity
  name: virtual magic ammo
  id: VirtualAmmo
  description: If you see this, please pay no attention.
  categories: [ HideSpawnMenu ]
  components:
  - type: CartridgeAmmo
    proto: ProjectileMagicTest

- type: entity
  id: ProjectileMagicTest
  name: magic test
  description: Don't worry about it.
  parent: BaseBullet
  categories: [ HideSpawnMenu ]
  components:
  - type: PointLight
    color: "#FFFFFF"
    radius: 2.0
    energy: 5.0
  - type: Projectile
    damage:
      types:
        Heat: 5
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: bullet
      shader: unshaded
  - type: IgnitionSource
    temperature: 400
    ignited: true
  - type: IgniteOnCollide
    fireStacks: 0.1

- type: entity
  name: wand of egg
  parent: BaseWeaponWand
  id: WandEgg
  description: Good luck trying to keep them intact.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: egg
  - type: BallisticAmmoProvider
    capacity: 12
    proto: VirtualAmmoEgg

- type: entity
  name: virtual magic ammo
  id: VirtualAmmoEgg
  description: If you see this, please pay no attention.
  categories: [ HideSpawnMenu ]
  components:
  - type: CartridgeAmmo
    proto: FoodEgg

- type: entity
  name: wand of bone toss
  parent: BaseWeaponWand
  id: WandBone
  description: Swing the calcium stick to throw a magic bone at someone.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: bone
  - type: BallisticAmmoProvider
    capacity: 8
    proto: VirtualAmmoBone

- type: entity
  name: virtual magic ammo
  id: VirtualAmmoBone
  description: If you see this, please pay no attention.
  categories: [ HideSpawnMenu ]
  components:
  - type: CartridgeAmmo
    proto: SpellBulletBone

- type: entity
  id: SpellBulletBone
  name: spinning bone
  description: Rattle rattle.
  parent: BaseBullet
  categories: [ HideSpawnMenu ]
  components:
  - type: PointLight
    color: "#FFDDAA"
    radius: 2.0
    energy: 3.0
  - type: Projectile
    damage:
      types:
        Blunt: 4
    soundHit:
      path: /Audio/Effects/bone_rattle.ogg
  - type: StaminaDamageOnCollide
    damage: 20
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: bone
      shader: unshaded
#  - type: Physics
#    angularVelocity: 2000

- type: entity
  id: BaseActionWand
  parent: BaseMagicItem
  abstract: true
  components:
  - type: ActionOnInteract
    actions:
    - ActionRgbLight
    
- type: entity
  id: WandLight
  parent: BaseActionWand
  name: wand of granting light
  description: The simplest form of abjuration.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: point
  - type: ActionOnInteract
    actions:
    - ActionGrantLight

- type: entity
  id: ActionGrantLight
  categories: [ HideSpawnMenu ]
  components:
  - type: EntityTargetAction
    useDelay: 10
    range: 1
    blacklist: { components: [ PointLight ] }
    charges: 5
    sound: /Audio/Magic/blink.ogg
    event: !type:ChangeComponentsSpellEvent
      toAdd:
      - type: PointLight

- type: entity
  id: WandDarkness
  parent: BaseActionWand
  name: wand of banishing light
  description: The second-simplest form of abjuration.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: squiggly
  - type: ActionOnInteract
    actions:
    - ActionBanishLight

- type: entity
  id: ActionBanishLight
  categories: [ HideSpawnMenu ]
  components:
  - type: EntityTargetAction
    useDelay: 10
    range: 1
    whitelist: { components: [ PointLight ] }
    charges: 5
    sound: /Audio/Magic/blink.ogg
    event: !type:ChangeComponentsSpellEvent
      toRemove: 
        - PointLight

- type: entity
  id: BaseSummoningWand
  parent: BaseMagicItem
  abstract: true
  components:
  - type: SpawnItemsOnUse
    uses: 3

- type: entity
  id: OrbSummonFox
  parent: BaseSummoningWand
  name: orb of summon fox
  description: You'd think you'd be able to summon something more impressive, but no. It's a fox.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Misc/magic_items.rsi
    layers:
    - state: orb
  - type: SpawnItemsOnUse
    items:
      - id: MobFoxCampguard
    sound:
      collection: VulpkaninBarks
    uses: 1

- type: entity
  id: ActionSummonFox
  categories: [ HideSpawnMenu ]
  components:
    - type: InstantAction
      #charges: 3
      useDelay: 300
      checkCanInteract: false
      event: !type:SummonPsionicFamiliarActionEvent
        familiarProto: MobFoxCampguard
        powerName: "Summon Fox"
        checkInsulation: false
        doGlimmerEffects: false
        followMaster: true

- type: entity
  parent: ClothingNeckCollarBase
  id: SteelCollarMagic
  name: steel chain-collar of pacifism
  description: Those wearing this have a hard time thinking of hurting others.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Clothing/steel_collar.rsi
  - type: Clothing
    sprite: _DEN/Unrefined/Objects/Clothing/steel_collar.rsi
  - type: ClothingGrantComponent
    component:
      - type: Pacified

- type: entity
  parent: SteelCollarMagic
  id: GoldCollarMagic
  name: gold chain-collar of pacifism
  description: Those wearing this have a really hard time thinking of hurting others.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Clothing/gold_collar.rsi
  - type: Clothing
    sprite: _DEN/Unrefined/Objects/Clothing/gold_collar.rsi
  - type: StaminaDamageResistance
    coefficient: 2
    
- type: entity
  parent: ClothingNeckBase
  id: AmuletProtection
  name: amulet of protection
  description: You feel a touch luckier with the sapphire around your neck.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Clothing/protection_amulet.rsi
  - type: Clothing
    sprite: _DEN/Unrefined/Objects/Clothing/protection_amulet.rsi
  - type: Armor
    modifiers:
      coefficients:
        #Blunt: 0.95
        #Slash: 0.95
        #Piercing: 0.95
        #Heat: 0.95
        #Cold: 0.95
        #Caustic: 0.95
        #Radiation: 0.95
        Poison: 0.95
      flatReductions:
        Poison: 0.5

# Grimoires and Self-spells

- type: entity
  parent: BookBase
  id: BookGrasslandsMagic
  name: A Primer on the Usage of Oleo-Runic Magic
  description: The first step on one of the forty-seven standard paths to becoming a magic user.
  components:
  - type: Paper
    content: book-text-magic-grasslands
  - type: RandomSprite
    available:
      - cover:
          cover_base: Sixteen
          cover_old: Sixteen
          cover_strong: Sixteen
        decor:
          decor_wingette: Sixteen
          decor_wingette_circle: Sixteen
          decor_bottom: Sixteen
          decor_middle: Sixteen
          decor_spine: Sixteen
          decor_diagonal: Sixteen
          decor_vertical_middle: Sixteen
          icon_corner: Sixteen
          icon_mount: ""
        icon:
          icon_biohazard: Sixteen
          icon_borg: ""
          icon_banana: ""
          icon_glow: Sixteen
          icon_hacking: ""
          icon_law: Sixteen
          icon_magnifier: ""
          icon_nuclear: ""
          icon_time: Sixteen
          icon_aurora: Sixteen
          icon_briefcase: ""
          icon_eye: ""
          icon_letter_N: ""
          icon_letter_P: ""
          icon_lightning: ""
          icon_planet: ""
          icon_possum: ""
          icon_question: Sixteen
          icon_scmmd: ""
          icon_stars: Sixteen
          icon_stars2: Sixteen
          icon_temple: Sixteen
          icon_tree: ""
          icon_pentagramm: Sixteen
          icon_fish: ""
          icon_origami: ""
          icon_skull: ""
          icon_text: ""
          icon_text2: ""
          icon_text3: ""
        overlay:
          overlay_blood: ""
          overlay_dirt: Sixteen
          detail_bookmark: Sixteen
          detail_rivets: Sixteen
          overlay_null: ""

- type: entity
  id: BookSelfPoly
  name: grimoire of minor transformations
  suffix: Survival
  parent: BaseItem
  description: Grants you the ability to make yourself very slightly more useless. Requires formata shards.
  components:
    - type: Sprite
      sprite: Objects/Misc/books.rsi
      layers:
      - state: paper_blood
      - state: cover_strong
        color: "#645a5a"
      - state: decor_wingette_flat
        color: "#4d0303"
      - state: icon_pentagramm
        color: "#f7e19f"
    - type: EmitSoundOnPickup
      sound: /Audio/SimpleStation14/Items/Handling/book_pickup.ogg
    - type: EmitSoundOnDrop
      sound: /Audio/SimpleStation14/Items/Handling/book_drop.ogg
    - type: EmitSoundOnLand
      sound: /Audio/SimpleStation14/Items/Handling/book_drop.ogg
    - type: UserInterface
      interfaces:
        enum.StoreUiKey.Key:
          type: StoreBoundUserInterface
    - type: ActivatableUI
      key: enum.StoreUiKey.Key
    - type: Store
      name: store-preset-name-spellbook-minorpoly
      categories:
      - PolyCritter
      - PolyToy
      currencyWhitelist:
      - Formata
      refundAllowed: false
      ownerOnly: false # get your own tome!
      balance:
        Formata: 0

- type: entity
  id: BookSelfPolyMajor
  name: grimoire of major transformations
  suffix: Survival/DO NOT MAP
  parent: BookSelfPoly
  description: Possessing this book is a good way to get a horde of wizards to rob you blind.
  components:
    - type: Store
      name: store-preset-name-spellbook-majorpoly
      categories:
      - PolyCritter
      - PolyToy
      - PolyMonster
      balance:
        Formata: 100

- type: entity
  name: formata shard
  parent: BaseItem
  id: FormataShard
  suffix: 1 Formata
  description: It is carefully etched with linear geometric forms. You feel like it would fit nicely in between some pages.
  components:
  - type: Sprite
    sprite: Objects/Materials/materials.rsi
    state: phoron_gem
  - type: Item
    sprite: Objects/Materials/materials.rsi
    size: Tiny
  - type: StaticPrice
    price: 0
  - type: Currency
    price:
      Formata: 1

- type: currency
  id: Formata
  displayName: store-currency-display-formata
  canWithdraw: false

- type: storeCategory
  id: PolyCritter
  name: store-category-polycritter
  
- type: storeCategory
  id: PolyToy
  name: store-category-polytoy
  
- type: storeCategory
  id: PolyMonster
  name: store-category-polymonster

# Note: Try to remove the HTN component of all mob transformations. Otherwise, they'll turn to NPCs when they disconnect or ghost.

- type: listing
  id: PolySelfMouse
  name: spellbook-polyself-mouse-name
  description: spellbook-polyself-mouse-desc
  productAction: ActionPolymorphSelfMouse
  cost:
    Formata: 3
  categories:
  - PolyCritter
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfMouse
  name: Mouse Polymorph
  description: Polymorphs you into a Mouse.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 120
    event: !type:PolymorphActionEvent
      protoId: SelfMouse
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Animals/mouse.rsi
      state: mouse-0

- type: entity
  parent: MobMouse
  id: MobMouseSelfPoly
  suffix: Polymorph
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound

- type: polymorph
  id: SelfMouse
  configuration:
    entity: MobMouseSelfPoly
    forced: false
    transferName: true
    #transferHumanoidAppearance: false
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfBat
  name: spellbook-polyself-bat-name
  description: spellbook-polyself-bat-desc
  productAction: ActionPolymorphSelfBat
  cost:
    Formata: 5
  categories:
  - PolyCritter
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfBat
  name: Bat Polymorph
  description: Polymorphs you into a Bat.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 240
    event: !type:PolymorphActionEvent
      protoId: SelfBat
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Animals/bat.rsi
      state: bat

- type: entity
  parent: MobBat
  id: MobBatSelfPoly
  suffix: Polymorph
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound

- type: polymorph
  id: SelfBat
  configuration:
    entity: MobBatSelfPoly
    forced: false
    transferName: true
    #transferHumanoidAppearance: false
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfMothroach
  name: spellbook-polyself-mothroach-name
  description: spellbook-polyself-mothroach-desc
  productAction: ActionPolymorphSelfMothroach
  cost:
    Formata: 3
  categories:
  - PolyCritter
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfMothroach
  name: Mothroach Polymorph
  description: Polymorphs you into a Mothroach.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 120
    event: !type:PolymorphActionEvent
      protoId: SelfMothroach
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Animals/mothroach.rsi
      state: mothroach

- type: entity
  parent: MobMothroach
  id: MobMothroachSelfPoly
  suffix: Polymorph
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound

- type: polymorph
  id: SelfMothroach
  configuration:
    entity: MobMothroachSelfPoly
    forced: false
    transferName: true
    #transferHumanoidAppearance: false
    inventory: None
    revertOnDeath: true
    revertOnCrit: true
    
- type: listing
  id: PolySelfPlushieFelinid
  name: spellbook-polyself-plushiefelinid-name
  description: spellbook-polyself-plushie-desc
  productAction: ActionPolymorphSelfPlushieFelinid
  cost:
    Formata: 1
  categories:
  - PolyToy
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfPlushieFelinid
  name: Felinid Plushie Polymorph
  description: Polymorphs you into a Felinid Plushie.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 120
    event: !type:PolymorphActionEvent
      protoId: SelfPlushieFelinid
    itemIconStyle: NoItem
    icon:
      sprite: _DV/Objects/Fun/Toys/plushies.rsi
      state: felinid

- type: polymorph
  id: SelfPlushieFelinid
  configuration:
    entity: PlushieFelinid
    forced: false
    transferName: true
    #transferHumanoidAppearance: true
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfPlushieOvinia
  name: spellbook-polyself-plushieovinia-name
  description: spellbook-polyself-plushie-desc
  productAction: ActionPolymorphSelfPlushieOvinia
  cost:
    Formata: 1
  categories:
  - PolyToy
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfPlushieOvinia
  name: Ovinia Plushie Polymorph
  description: Polymorphs you into an Ovinia Plushie.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 120
    event: !type:PolymorphActionEvent
      protoId: SelfPlushieOvinia
    itemIconStyle: NoItem
    icon:
      sprite: _DEN/Objects/Fun/oviniaplushie.rsi
      state: icon

- type: polymorph
  id: SelfPlushieOvinia
  configuration:
    entity: PlushieOvinia
    forced: false
    transferName: true
    #transferHumanoidAppearance: true
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfDragon
  name: spellbook-polyself-dragon-name
  description: spellbook-polyself-dragon-desc
  productAction: ActionPolymorphSelfDragon
  cost:
    Formata: 99
  categories:
  - PolyMonster
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfDragon
  name: Dragon Polymorph
  description: Polymorphs you into a Space Dragon.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 600
    event: !type:PolymorphActionEvent
      protoId: SelfDragon
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Aliens/Carps/dragon.rsi
      state: alive

- type: entity
  parent: MobDragonDungeon
  id: MobDragonSelfPoly
  suffix: Polymorph
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound
  - type: Devourer
    shouldStoreDevoured: false  

- type: polymorph
  id: SelfDragon
  configuration:
    entity: MobDragonSelfPoly
    forced: false
    transferName: true
    #transferHumanoidAppearance: true
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfCarp
  name: spellbook-polyself-carp-name
  description: spellbook-polyself-carp-desc
  productAction: ActionPolymorphSelfCarp
  cost:
    Formata: 25
  categories:
  - PolyMonster
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfCarp
  name: Carp Polymorph
  description: Polymorphs you into a Space Carp.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 300
    event: !type:PolymorphActionEvent
      protoId: SelfCarp
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Aliens/Carps/space.rsi
      state: alive

- type: entity
  parent: MobCarp
  id: MobCarpSelfPoly
  suffix: Polymorph
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound

- type: polymorph
  id: SelfCarp
  configuration:
    entity: MobCarpSelfPoly
    forced: false
    transferName: true
    #transferHumanoidAppearance: true
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfGoliath
  name: spellbook-polyself-goliath-name
  description: spellbook-polyself-goliath-desc
  productAction: ActionPolymorphSelfGoliath
  cost:
    Formata: 90
  categories:
  - PolyMonster
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfGoliath
  name: Goliath Polymorph
  description: Polymorphs you into a Space Goliath.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 600
    event: !type:PolymorphActionEvent
      protoId: SelfGoliath
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Aliens/Asteroid/goliath.rsi
      state: goliath

- type: entity
  id: MobGoliathPolySelf
  parent: MobGoliath
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound
  - type: MobThresholds
    thresholds:
      0: Alive
      200: Dead

- type: polymorph
  id: SelfGoliath
  configuration:
    entity: MobGoliathPolySelf
    forced: false
    transferName: true
    #transferHumanoidAppearance: true
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfWatcherIce
  name: spellbook-polyself-watcherice-name
  description: spellbook-polyself-watcher-desc
  productAction: ActionPolymorphSelfWatcherIce
  cost:
    Formata: 60
  categories:
  - PolyMonster
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfWatcherIce
  name: Icewing Watcher Polymorph
  description: Polymorphs you into an Icewing Watcher.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 300
    event: !type:PolymorphActionEvent
      protoId: SelfWatcherIce
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Aliens/Lavaland/watcher.rsi
      state: unshaded
      color: deepskyblue

- type: entity
  parent: MobWatcherIcewing
  id: MobWatcherIcewingSelfPoly
  suffix: Polymorph
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound

- type: polymorph
  id: SelfWatcherIce
  configuration:
    entity: MobWatcherIcewingSelfPoly
    forced: false
    transferName: true
    #transferHumanoidAppearance: true
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

- type: listing
  id: PolySelfWatcherMagma
  name: spellbook-polyself-watchermagma-name
  description: spellbook-polyself-watcher-desc
  productAction: ActionPolymorphSelfWatcherMagma
  cost:
    Formata: 60
  categories:
  - PolyMonster
  conditions:
  - !type:ListingLimitedStockCondition
    stock: 1

- type: entity
  id: ActionPolymorphSelfWatcherMagma
  name: Magmawing Watcher Polymorph
  description: Polymorphs you into a Magmawing Watcher.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    useDelay: 300
    event: !type:PolymorphActionEvent
      protoId: SelfWatcherMagma
    itemIconStyle: NoItem
    icon:
      sprite: Mobs/Aliens/Lavaland/watcher.rsi
      state: unshaded
      color: orangered

- type: entity
  parent: MobWatcherMagmawing
  id: MobWatcherMagmawingSelfPoly
  suffix: Polymorph
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
      task: IdleCompound

- type: polymorph
  id: SelfWatcherMagma
  configuration:
    entity: MobWatcherMagmawingSelfPoly
    forced: false
    transferName: true
    #transferHumanoidAppearance: true
    inventory: None
    revertOnDeath: true
    revertOnCrit: true

# Admin things. Do not give out willy-nilly.

- type: entity
  name: wand of turn to mouse
  parent: BaseWeaponWand
  id: WandMouse
  description: A perfect way to pacify opponents.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: egg
  - type: BallisticAmmoProvider
    capacity: 3
    proto: ProjectilePolyboltMouse

- type: entity
  id: ProjectilePolyboltMouse
  parent: ProjectilePolyboltBase
  name: mouse polybolt
  description: Nooo, I don't wanna be mouse!
  categories: [ HideSpawnMenu ]
  components:
  - type: PolymorphOnCollide
    polymorph: SelfMouse
    whitelist:
      components:
      - Body

- type: entity
  name: wand of turn to plushie
  parent: BaseWeaponWand
  id: WandPlushie
  description: It might as well be called "instant death" instead.
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Objects/Weapons/wand.rsi
    layers:
    - state: egg
  - type: BallisticAmmoProvider
    capacity: 3
    proto: ProjectilePolyboltPlushie

- type: entity
  id: ProjectilePolyboltPlushie
  parent: ProjectilePolyboltBase
  name: plushie polybolt
  description: Nooo, I don't wanna be a marketable plushie!
  categories: [ HideSpawnMenu ]
  components:
  - type: PolymorphOnCollide
    polymorph: SelfPlushieFelinid
    whitelist:
      components:
      - Body

# Magic Octogram

- type: entity
  parent: BaseHandPoweredLathe # [BaseLathe, BaseMaterialSiloUtilizer]
  id: MagicOctogram
  name: magic octogram
  description: It's easier to put things together if you can hold them against a surface.
  #placementMode: SnapgridBorder
  components:
  - type: Sprite
    sprite: _DEN/Unrefined/Structures/Misc/magic_octogram.rsi
    drawdepth: FloorObjects
    layers:
    - state: pastel
      shader: unshaded
  - type: Physics
    bodyType: Static
    canCollide: false
  - type: MaterialStorage
    ignoreColor: true
    whitelist:
      tags:
      - Ore
      - Wooden
      - RawMaterial
      - ClothMade
      - Gauze
      - Sheet
      - RawMaterial
      - Ingot
      - Metal
      - MagicEssence
  - type: Lathe
    producingSound: /Audio/Magic/staff_animation.ogg
    idleState: pastel
    runningState: pastel
    defaultProductionAmount: 1
    staticPacks:
    - MagicOctogramStatic
  - type: Construction
    graph: MagicOctogram
    node: octogram

- type: entity
  parent: MagicOctogram
  id: MagicOctogramColor
  suffix: colorful
  components:
  - type: Sprite
    layers:
    - state: icon
      shader: unshaded
  - type: Lathe
    idleState: icon
    runningState: spin
  - type: Construction
    graph: MagicOctogram
    node: colorful
    
- type: entity
  parent: MagicOctogramColor
  id: MagicOctogramSpin
  suffix: spin
  components:
  - type: Sprite
    layers:
    - state: spin
      shader: unshaded
  - type: Lathe
    idleState: spin
    runningState: spin
#  - type: Construction
#    graph: MagicOctogram
#    node: spin


# Oleomagium, Magic Essences, and Reactions

- type: reagent
  id: Oleomagium
  name: reagent-name-oleomagium
  group: Exotic
  desc: reagent-desc-oleomagium
  flavor: enthralling
  color: "#FFFFFF"
  physicalDesc: reagent-physical-desc-overpowering
  metabolisms:
    Narcotic:
      metabolismRate: 0.2
      effects:
      - !type:GenericStatusEffect
        key: SeeingRainbows
        component: SeeingRainbows
        type: Add
        time: 5
        refresh: false
      - !type:ChemRerollPsionic
        bonusMultiplier: 1
        conditions:
        - !type:ReagentThreshold
          reagent: Oleomagium
          min: 15

- type: entity
  abstract: true
  parent: BaseItem
  id: BaseEssence
  components:
  - type: Sprite
    sprite: _Den/Unrefined/Objects/Misc/magic_essence.rsi
  - type: Item
    size: Small
  - type: Tag
    tags:
    - MagicEssence
    - RawMaterial
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeCircle
          radius: 0.2
        density: 20
        mask:
          - ItemMask
        restitution: 0.3
        friction: 0.2
  - type: Damageable
    damageContainer: Inorganic
    damageModifierSet: Metallic
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
      - !type:DoActsBehavior
        acts: [ "Destruction" ]

- type: Tag
  id: MagicEssence
  
- type: entity
  parent: BaseEssence
  id: EssenceEarth
  name: essence of earth
  description:  It feels lumpy to the touch.
  components:
  - type: Sprite
    state: earth
  - type: Item
  - type: Material
  - type: PhysicalComposition
    materialComposition:
      EarthEssence: 100

- type: material
  id: EarthEssence
  stackEntity: EssenceEarth
  name: materials-essence-earth
  unit: materials-unit-essence
  icon: { sprite: /Textures/_Den/Unrefined/Objects/Misc/magic_essence.rsi, state: earth }
  price: 10

- type: reaction
  id: CreateEarthEssenceCarbon
  quantized: true
  reactants:
    Carbon:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceEarth
      
- type: reaction
  id: CreateEarthEssenceIron
  quantized: true
  reactants:
    Iron:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceEarth

- type: entity
  parent: BaseEssence
  id: EssenceBlood
  name: essence of blood
  description:  Like candy for vampires.
  components:
  - type: Sprite
    state: blood
  - type: Item
  - type: Material
  - type: PhysicalComposition
    materialComposition:
      BloodEssence: 100

- type: material
  id: BloodEssence
  stackEntity: EssenceBlood
  name: materials-essence-blood
  unit: materials-unit-essence
  icon: { sprite: /Textures/_Den/Unrefined/Objects/Misc/magic_essence.rsi, state: blood }
  price: 10
      
- type: reaction
  id: CreateBloodEssence
  quantized: true
  reactants:
    Blood:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceBlood
      
- type: reaction
  id: CreateBloodEssenceSlime
  quantized: true
  reactants:
    Slime:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceBlood
      
- type: entity
  parent: BaseEssence
  id: EssenceFire
  name: essence of fire
  description:  It's surprising that you don't burn your hands touching this.
  components:
  - type: Sprite
    state: fire
  - type: Item
  - type: Material
  - type: PhysicalComposition
    materialComposition:
      FireEssence: 100

- type: material
  id: FireEssence
  stackEntity: EssenceFire
  name: materials-essence-fire
  unit: materials-unit-essence
  icon: { sprite: /Textures/_Den/Unrefined/Objects/Misc/magic_essence.rsi, state: fire }
  price: 10
  
- type: reaction
  id: CreateFireEssence
  quantized: true
  reactants:
    Charcoal:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceFire
      
- type: reaction
  id: CreateFireEssenceWeldingFuel
  quantized: true
  reactants:
    WeldingFuel:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceFire
      
- type: entity
  parent: BaseEssence
  id: EssenceWater
  name: essence of water
  description:  Probably not safe for most people to drink.
  components:
  - type: Sprite
    state: water
  - type: Item
  - type: Material
  - type: PhysicalComposition
    materialComposition:
      WaterEssence: 100

- type: material
  id: WaterEssence
  stackEntity: EssenceWater
  name: materials-essence-water
  unit: materials-unit-essence
  icon: { sprite: /Textures/_Den/Unrefined/Objects/Misc/magic_essence.rsi, state: water }
  price: 10
  
- type: reaction
  id: CreateWaterEssence
  quantized: true
  reactants:
    Water:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceWater
      
- type: reaction
  id: CreateWaterEssenceIce
  quantized: true
  reactants:
    Ice:
      amount: 40
    Oleomagium:
      amount: 5
      catalyst: true
  effects:
    - !type:CreateEntityReactionEffect
      entity: EssenceWater

- type: entityTable
  id: MagicEssenceTable
  table: !type:GroupSelector
    children:
    - !type:GroupSelector
      weight: 10
      children:
      - id: EssenceWater
      - id: EssenceEarth
      - id: EssenceBlood
      - id: EssenceWater
      
- type: entity
  parent: MarkerBase
  id: RandomMagicEssence
  name: random magic essence spawner
  components:
    - type: Sprite
      layers:
        - state: red
        - sprite: _Den/Unrefined/Objects/Misc/magic_essence.rsi
          state: earth
    - type: EntityTableSpawner
      offset: 0.2
      table: !type:NestedSelector
        tableId: MagicEssenceTable
        prob: 1
