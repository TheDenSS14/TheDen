# SPDX-FileCopyrightText: 2022 Aerocrux
# SPDX-FileCopyrightText: 2022 CommieFlowers
# SPDX-FileCopyrightText: 2022 CrudeWax
# SPDX-FileCopyrightText: 2022 Flipp Syder
# SPDX-FileCopyrightText: 2022 Paul Ritter
# SPDX-FileCopyrightText: 2022 mirrorcult
# SPDX-FileCopyrightText: 2022 rolfero
# SPDX-FileCopyrightText: 2023 Debug
# SPDX-FileCopyrightText: 2023 Derby
# SPDX-FileCopyrightText: 2023 DerbyX
# SPDX-FileCopyrightText: 2023 I.K
# SPDX-FileCopyrightText: 2023 Jackrost
# SPDX-FileCopyrightText: 2023 Jezithyr
# SPDX-FileCopyrightText: 2023 Kara
# SPDX-FileCopyrightText: 2023 PilgrimViis
# SPDX-FileCopyrightText: 2023 lzk228
# SPDX-FileCopyrightText: 2023 notquitehadouken
# SPDX-FileCopyrightText: 2024 AJCM
# SPDX-FileCopyrightText: 2024 Alex Evgrashin
# SPDX-FileCopyrightText: 2024 Alex Pavlenko
# SPDX-FileCopyrightText: 2024 Alice "Arimah" Heurlin
# SPDX-FileCopyrightText: 2024 Alzore
# SPDX-FileCopyrightText: 2024 ArkiveDev
# SPDX-FileCopyrightText: 2024 Boaz1111
# SPDX-FileCopyrightText: 2024 Brandon Hu
# SPDX-FileCopyrightText: 2024 CaasGit
# SPDX-FileCopyrightText: 2024 Chief-Engineer
# SPDX-FileCopyrightText: 2024 Cojoke
# SPDX-FileCopyrightText: 2024 DEATHB4DEFEAT
# SPDX-FileCopyrightText: 2024 Doomsdrayk
# SPDX-FileCopyrightText: 2024 DrSmugleaf
# SPDX-FileCopyrightText: 2024 Ed
# SPDX-FileCopyrightText: 2024 Emisse
# SPDX-FileCopyrightText: 2024 EmoGarbage404
# SPDX-FileCopyrightText: 2024 Eoin Mcloughlin
# SPDX-FileCopyrightText: 2024 Fishbait
# SPDX-FileCopyrightText: 2024 Flareguy
# SPDX-FileCopyrightText: 2024 Ghagliiarghii
# SPDX-FileCopyrightText: 2024 HS
# SPDX-FileCopyrightText: 2024 Hrosts
# SPDX-FileCopyrightText: 2024 IProduceWidgets
# SPDX-FileCopyrightText: 2024 Ian
# SPDX-FileCopyrightText: 2024 Joel Zimmerman
# SPDX-FileCopyrightText: 2024 JustCone
# SPDX-FileCopyrightText: 2024 Killerqu00
# SPDX-FileCopyrightText: 2024 Ko4ergaPunk
# SPDX-FileCopyrightText: 2024 Kukutis96513
# SPDX-FileCopyrightText: 2024 Leon Friedrich
# SPDX-FileCopyrightText: 2024 Lye
# SPDX-FileCopyrightText: 2024 MerrytheManokit
# SPDX-FileCopyrightText: 2024 Mervill
# SPDX-FileCopyrightText: 2024 MilenVolf
# SPDX-FileCopyrightText: 2024 Mr. 27
# SPDX-FileCopyrightText: 2024 MureixloI
# SPDX-FileCopyrightText: 2024 NakataRin
# SPDX-FileCopyrightText: 2024 Nemanja
# SPDX-FileCopyrightText: 2024 OrangeMoronage9622
# SPDX-FileCopyrightText: 2024 PJBot
# SPDX-FileCopyrightText: 2024 Partmedia
# SPDX-FileCopyrightText: 2024 Pieter-Jan Briers
# SPDX-FileCopyrightText: 2024 Piras314
# SPDX-FileCopyrightText: 2024 Plykiya
# SPDX-FileCopyrightText: 2024 Preston Smith
# SPDX-FileCopyrightText: 2024 Psychpsyo
# SPDX-FileCopyrightText: 2024 Redfire1331
# SPDX-FileCopyrightText: 2024 Repo
# SPDX-FileCopyrightText: 2024 RiceMar1244
# SPDX-FileCopyrightText: 2024 Rouge2t7
# SPDX-FileCopyrightText: 2024 ShadowCommander
# SPDX-FileCopyrightText: 2024 Simon
# SPDX-FileCopyrightText: 2024 SlamBamActionman
# SPDX-FileCopyrightText: 2024 SoulFN
# SPDX-FileCopyrightText: 2024 Stalen
# SPDX-FileCopyrightText: 2024 TakoDragon
# SPDX-FileCopyrightText: 2024 Tayrtahn
# SPDX-FileCopyrightText: 2024 Thomas
# SPDX-FileCopyrightText: 2024 Truoizys
# SPDX-FileCopyrightText: 2024 TsjipTsjip
# SPDX-FileCopyrightText: 2024 Ubaser
# SPDX-FileCopyrightText: 2024 Unkn0wn_Gh0st
# SPDX-FileCopyrightText: 2024 Vasilis
# SPDX-FileCopyrightText: 2024 Vigers Ray
# SPDX-FileCopyrightText: 2024 Whisper
# SPDX-FileCopyrightText: 2024 YourUsername
# SPDX-FileCopyrightText: 2024 beck-thompson
# SPDX-FileCopyrightText: 2024 deathride58
# SPDX-FileCopyrightText: 2024 deltanedas
# SPDX-FileCopyrightText: 2024 dffdff2423
# SPDX-FileCopyrightText: 2024 eoineoineoin
# SPDX-FileCopyrightText: 2024 fishbait
# SPDX-FileCopyrightText: 2024 foboscheshir
# SPDX-FileCopyrightText: 2024 github-actions[bot]
# SPDX-FileCopyrightText: 2024 gluesniffler
# SPDX-FileCopyrightText: 2024 godisdeadLOL
# SPDX-FileCopyrightText: 2024 lzk
# SPDX-FileCopyrightText: 2024 metalgearsloth
# SPDX-FileCopyrightText: 2024 neutrino
# SPDX-FileCopyrightText: 2024 nikthechampiongr
# SPDX-FileCopyrightText: 2024 no
# SPDX-FileCopyrightText: 2024 osjarw
# SPDX-FileCopyrightText: 2024 plykiya
# SPDX-FileCopyrightText: 2024 redfire1331
# SPDX-FileCopyrightText: 2024 saintmuntzer
# SPDX-FileCopyrightText: 2024 shamp
# SPDX-FileCopyrightText: 2024 sleepyyapril
# SPDX-FileCopyrightText: 2024 strO0pwafel
# SPDX-FileCopyrightText: 2024 stroopwafel
# SPDX-FileCopyrightText: 2024 themias
# SPDX-FileCopyrightText: 2024 to4no_fix
# SPDX-FileCopyrightText: 2024 voidnull000
# SPDX-FileCopyrightText: 2024 Арт
# SPDX-FileCopyrightText: 2025 Aiden
# SPDX-FileCopyrightText: 2025 Aidenkrz
# SPDX-FileCopyrightText: 2025 Aviu00
# SPDX-FileCopyrightText: 2025 Errant
# SPDX-FileCopyrightText: 2025 ExponentialWizard
# SPDX-FileCopyrightText: 2025 GoobBot
# SPDX-FileCopyrightText: 2025 Ilya246
# SPDX-FileCopyrightText: 2025 Jakumba
# SPDX-FileCopyrightText: 2025 Rinary
# SPDX-FileCopyrightText: 2025 Rouden
# SPDX-FileCopyrightText: 2025 Roudenn
# SPDX-FileCopyrightText: 2025 Spatison
# SPDX-FileCopyrightText: 2025 Theodore Lukin
# SPDX-FileCopyrightText: 2025 VMSolidus
# SPDX-FileCopyrightText: 2025 gus
# SPDX-FileCopyrightText: 2025 slarticodefast
# SPDX-FileCopyrightText: 2025 thebiggestbruh
#
# SPDX-License-Identifier: AGPL-3.0-or-later

- type: entity
  parent: [ SimpleSpaceMobBase, FlyingMobBase ]
  id: BaseMobDragon
  suffix: ""
  name: space dragon
  description: A flying leviathan, loosely related to space carps.
  abstract: true
  components:
  - type: Body # Shitmed
    prototype: SpaceDragon
  - type: SurgeryTarget # Shitmed
  - type: UserInterface # Shitmed
    interfaces:
      enum.SurgeryUIKey.Key:
        type: SurgeryBui
  - type: Bloodstream
    maxBleedAmount: 0
    bloodMaxVolume: 650
  - type: GhostRole
    allowMovement: true
    allowSpeech: true
    makeSentient: true
    name: ghost-role-information-space-dragon-name
    description: ghost-role-information-space-dragon-description
    rules: ghost-role-information-space-dragon-rules
    mindRoles:
    - MindRoleGhostRoleTeamAntagonist
    raffle:
      settings: default
  - type: GhostTakeoverAvailable
  - type: HTN
    rootTask:
      task: XenoCompound
    blackboard:
      NavInteract: !type:Bool
        true
      NavPry: !type:Bool
        true
      NavSmash: !type:Bool
        true
  - type: NpcFactionMember
    factions:
    - Dragon
  - type: Speech
    speechVerb: LargeMob
  - type: CombatMode
  - type: MobMover
  - type: InputMover
  - type: MovementSpeedModifier
    baseWalkSpeed: 3
    baseSprintSpeed: 5
    weightlessModifier: 1.5
  - type: RandomSprite
    available:
    - enum.DamageStateVisualLayers.Base:
        alive: Rainbow
  - type: Sprite
    sprite: Mobs/Aliens/Carps/dragon.rsi
    noRot: true
    layers:
    - map: [ "enum.DamageStateVisualLayers.Base" ]
      state: alive
    - map: [ "enum.DamageStateVisualLayers.BaseUnshaded" ]
      state: alive-unshaded
      shader: unshaded
  - type: Appearance
  - type: DamageStateVisuals
    states:
      Alive:
        Base: alive
        BaseUnshaded: alive-unshaded
      Critical:
        Base: crit
      Dead:
        Base: dead
        BaseUnshaded: dead-unshaded
  - type: Physics
    bodyType: KinematicController
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeCircle
          radius: 0.40
        density: 100
        mask:
        - FlyingMobMask
        layer:
        - FlyingMobLayer
  - type: MobState
  - type: MobStateActions
    actions:
      Critical:
      - ActionCritSuccumb
      - ActionCritLastWords
  - type: MobThresholds
    thresholds:
      0: Alive
      450: Critical
      500: Dead
  - type: SlowOnDamage
    speedModifierThresholds:
      300: 0.85
      400: 0.65
  # disable taking damage from fire, since its a fire breathing dragon
  - type: Flammable
    damage:
      types: {}
  - type: StatusEffects # Overwriting basesimplemob to remove flash, getting flashed as dragon just feelsbad
    allowed:
    - SlowedDown
    - Stutter
    - Electrocution
    - ForcedSleep
    - TemporaryBlindness
    - Pacified
    - RadiationProtection
    - Drowsiness
    - Adrenalin
  - type: Temperature
    heatDamageThreshold: 800
  - type: Metabolizer
    solutionOnBody: false
    updateInterval: 0.25
    metabolizerTypes: [ Dragon ]
    groups:
    - id: Medicine
    - id: Poison
  - type: Butcherable
    spawned:
    - id: FoodMeatDragon
      amount: 2
  - type: InteractionPopup
    successChance: 0.25 # It's no goose, but you better smell like carp.
    interactSuccessString: petting-success-dragon
    interactFailureString: petting-failure-dragon
    interactFailureSound:
      path: /Audio/Animals/space_dragon_roar.ogg
    soundPerceivedByOthers: false # A 75% chance for a loud roar would get old fast.
  - type: MeleeWeapon
    altDisarm: false
    soundHit:
      path: /Audio/Weapons/Xeno/alien_claw_flesh3.ogg
    damage:
      types:
        Piercing: 15
        Slash: 15
  - type: AntiRottingContainer
  - type: Devourer
    healDamage:
      types:
        Heat: -35
      groups:
        Brute: -35
    shouldStoreDevoured: true
    chemical: Ichor
    healRate: 15.0
    foodPreference: Humanoid
    whitelist:
      components:
      - MobState
      - Door
      - Item # Goobstation
      tags:
      - Wall
  - type: Tag
    tags:
    - CannotSuicide
    - DoorBumpOpener
  - type: Damageable # Goobstation
    damageContainer: Biological
    damageModifierSet: Dragon
  - type: Puller
    needsHands: false
  - type: NightVision # Goobstation - Nigthvision
    color: "#808080"
    activateSound: null
    deactivateSound: null
  - type: ThermalVision # Goobstation - Thermal vision
  - type: Fauna # Lavaland Change
  - type: PassiveDamage # Around 19 damage a minute healed - don't let it heal.
    allowedStates:
    - Alive
    damage:
      types:
        Heat: -0.34
      groups:
        Brute: -0.34
  - type: RandomMetadata
    nameSegments:
    - NamesDragon
    - NamesDragonTitle
    nameFormat: name-format-dragon
  - type: Tool
    speedModifier: 3.5
    qualities:
      - Prying
  - type: Prying
    pryPowered: true
    force: true
    speedModifier: 3.5 # fast because dragon strong
    useSound:
      path: /Audio/Items/crowbar.ogg
  - type: Hands
  - type: ComplexInteraction

- type: entity
  parent: BaseMobDragon
  id: MobDragon
  suffix: No role or objectives
  components:
  - type: Dragon
    spawnRiftAction: ActionSpawnRift
    carpRiftHealing:
      groups:
        Brute: -4
        Burn: -4
        # Airloss: -3 Den - our dragons don't bleed
  - type: GhostRole
    mindRoles:
    - MindRoleDragon
  #- type: ActionGun # Goobstation - remove fireball because it's tied to lungs now
  #  action: ActionDragonsBreath
  #  gunProto: DragonsBreathGun
  - type: GuideHelp
    guides:
    - MinorAntagonists

- type: entity
  categories: [ HideSpawnMenu ]
  id: DragonsBreathGun
  name: dragon's lung
  description: For dragon's breathing.
  components:
  - type: RechargeBasicEntityAmmo
    rechargeCooldown: 5
    rechargeSound:
      path: /Audio/Animals/space_dragon_roar.ogg
  - type: BasicEntityAmmoProvider
    proto: ProjectileDragonsBreath
    capacity: 1
    count: 1
  - type: Gun
    soundGunshot:
      path: /Audio/Animals/space_dragon_roar.ogg
    soundEmpty: null
    projectileSpeed: 5

- type: entity
  parent: BaseMobDragon
  id: MobDragonDungeon
  suffix: Dungeon
  components:
  - type: GhostRole
    description: ghost-role-information-space-dragon-dungeon-description
    rules: ghost-role-information-space-dragon-dungeon-rules
    raffle:
      settings: default
  - type: SlowOnDamage
    speedModifierThresholds:
      100: 0.7
  - type: MobThresholds
    thresholds:
      0: Alive
      200: Dead
  # less meat spawned since it's a lot easier to kill
  - type: Butcherable
    spawned:
    - id: FoodMeatDragon
      amount: 1
  - type: MeleeWeapon
    damage:
      groups:
        Brute: 12

- type: entity
  id: ActionSpawnRift
  name: Summon Carp Rift
  description: Summons a carp rift that will periodically spawns carps.
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    icon:
      sprite: Interface/Actions/carp_rift.rsi
      state: icon
    event: !type:DragonSpawnRiftActionEvent
    useDelay: 1
    priority: 3

- type: entity
  id: ActionDevour
  name: "[color=red]Devour[/color]"
  description: Attempt to break a structure with your jaws or swallow a creature.
  categories: [ HideSpawnMenu ]
  components:
  - type: EntityTargetAction
    icon: { sprite : Interface/Actions/devour.rsi, state: icon }
    iconOn: { sprite : Interface/Actions/devour.rsi, state: icon-on }
    event: !type:DevourActionEvent
    priority: 1

- type: entity
  id: ActionDragonsBreath
  name: "[color=orange]Dragon's Breath[/color]"
  description: Spew out flames at anyone foolish enough to attack you!
  categories: [ HideSpawnMenu ]
  components:
  - type: WorldTargetAction
    # TODO: actual sprite
    icon: { sprite : Objects/Weapons/Guns/Projectiles/magic.rsi, state: fireball }
    event: !type:ActionGunShootEvent
    priority: 2
    checkCanAccess: false
    range: 0
    itemIconStyle: BigAction

# Goobstation start: dragon rework
- type: entity
  id: ActionRiseFish
  name: Summon Carp Horde
  description: Summons 3 carps on the spot to protect you from danger!
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    icon:
      sprite: _Goobstation/Actions/dragon.rsi
      state: carp_horde
    event: !type:DragonSpawnCarpHordeActionEvent
    useDelay: 90
    priority: 4

- type: entity
  id: ActionDragonRoar
  name: Wing flap
  description: Flap your wings to snare all enemies around you!
  categories: [ HideSpawnMenu ]
  components:
  - type: InstantAction
    icon:
      sprite: _Goobstation/Actions/dragon.rsi
      state: wing_flap
    event: !type:DragonRoarActionEvent
    useDelay: 30
    priority: 5
# Goobstation end
