// SPDX-FileCopyrightText: 2025 Lyndomen <49795619+Lyndomen@users.noreply.github.com>
// SPDX-FileCopyrightText: 2025 sleepyyapril <123355664+sleepyyapril@users.noreply.github.com>
//
// SPDX-License-Identifier: AGPL-3.0-or-later AND MIT

using Content.Shared._CD.Records;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.CustomControls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client._CD.Admin.UI;

[GenerateTypedNameReferences]
public sealed partial class ModifyCharacterRecords : DefaultWindow
{
    public ModifyCharacterRecords()
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);

        foreach (var v in Enum.GetValues<CharacterRecordType>())
        {
            EntityEntryType.AddItem(v.ToString());
        }

        EntityEntryType.OnItemSelected += args =>
        {
            EntityEntryType.SelectId(args.Id);
            UpdateCommands();
        };

        EntityEdit.OnTextChanged += _ => UpdateCommands();
        EntityEntryIndex.OnTextChanged += _ => UpdateCommands();
    }

    private void UpdateCommands()
    {
        if (!int.TryParse(EntityEdit.Text, out var uid))
        {
            return;
        }

        if (!int.TryParse(EntityEntryIndex.Text, out var idx))
        {
            return;
        }

        var ty = (CharacterRecordType)EntityEntryType.SelectedId;

        PurgeCommand.Command = $"purgecharacterrecords {uid}";
        DelCommand.Command = $"delrecordentry {uid} {ty.ToString()} {idx}";
    }
}
